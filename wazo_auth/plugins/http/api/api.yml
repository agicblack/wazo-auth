swagger: '2.0'
info:
  version: '0.1'
  title: wazo-auth
  description: "Wazo's authentication service"
  contact:
    name: Wazo dev team
    url: http://wazo.community
    email: dev@wazo.community
  license:
    name: GPLv3
    url: http://www.gnu.org/licenses/gpl-3.0.html
x-xivo-port: 9497
x-xivo-name: auth
basePath: /0.1
schemes:
- https
consumes:
- application/json
produces:
- application/json
securityDefinitions:
  wazo_auth_basic:
    type: basic
  wazo_auth_token:
    type: apiKey
    name: X-Auth-Token
    in: header
paths:
  /users/{user_uuid}/tenants:
    get:
      tags:
        - users
      security:
      - wazo_auth_token: []
      description: '**Required ACL**: `auth.users.{user_uuid}.tenants.read`'
      parameters:
      - $ref: '#/parameters/order'
      - $ref: '#/parameters/direction'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      - $ref: '#/parameters/search'
      - $ref: '#/parameters/user_uuid'
      summary: Retrieves the details of a user
      responses:
        '200':
          description: "The user's tenant list"
          schema:
            $ref: '#/definitions/TenantList'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: User not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: System related error
          schema:
            $ref: '#/definitions/Error'
  /users/{user_uuid}/policies:
    get:
      tags:
        - users
        - policies
      security:
      - wazo_auth_token: []
      description: '**Required ACL**: `auth.users.{user_uuid}.policies.read`'
      parameters:
      - $ref: '#/parameters/user_uuid'
      - $ref: '#/parameters/order'
      - $ref: '#/parameters/direction'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      - $ref: '#/parameters/search'
      summary: Retrieves the list of policies associated to a user
      responses:
        '200':
          description: "The user's policies"
          schema:
            $ref: '#/definitions/GetPoliciesResult'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: User not found
          schema:
            $ref: '#/definitions/Error'
        '500':
          description: System related error
          schema:
            $ref: '#/definitions/Error'
  /users/{user_uuid}/policies/{policy_uuid}:
    put:
      tags:
        - users
        - policies
      security:
        - wazo_auth_token: []
      operationId: addUserPolicy
      description: '**Required ACL:** `auth.users.{user_uuid}.policies.{policy_uuid}.create`'
      summary: Associate a policy to a user
      parameters:
      - $ref: '#/parameters/policy_uuid'
      - $ref: '#/parameters/user_uuid'
      responses:
        '204':
          description: The policy has been assigned
        '404':
          description: User or Policy not found
          schema:
            $ref: '#/definitions/Error'
    delete:
      tags:
        - users
        - policies
      security:
        - wazo_auth_token: []
      operationId: removeUserPolicy
      description: '**Required ACL:** `auth.users.{user_uuid}.policies.{policy_uuid}.delete`'
      summary: Dissociate a policy from a user
      parameters:
      - $ref: '#/parameters/policy_uuid'
      - $ref: '#/parameters/user_uuid'
      responses:
        '204':
          description: The policy has been unassigned
        '404':
          description: User or Policy not found
          schema:
            $ref: '#/definitions/Error'
parameters:
  direction:
    required: false
    name: direction
    in: query
    type: string
    enum:
    - asc
    - desc
    description: Sort list of items in 'asc' (ascending) or 'desc' (descending) order
  group_uuid:
    name: group_uuid
    in: path
    type: string
    description: The UUID of the group
    required: true
  limit:
    name: limit
    in: query
    type: integer
    description: The limit defines the number of individual objects that are returned
    required: false
  offset:
    name: offset
    in: query
    type: integer
    description: The offset defines the offsets the start by the number specified
    default: 0
    required: false
  order:
    required: false
    name: order
    in: query
    type: string
    description: Name of the field to use for sorting the list of items returned.
  policy_uuid:
    name: policy_uuid
    in: path
    type: string
    description: The UUID of the policy
    required: true
  user_uuid:
    name: user_uuid
    in: path
    type: string
    description: The UUID of the user
    required: true
  search:
    required: false
    name: search
    in: query
    type: string
    description: Search term for filtering a list of items. Only items with a field
      containing the search term will be returned.
definitions:
  APIError:
    type: object
    properties:
      timestamp:
        type: number
      message:
        type: string
      resource:
        type: string
      details:
        type: object
  UserEmail:
    type: object
    properties:
      address:
        type: string
      main:
        type: boolean
      confirmed:
        type: boolean
  UserPostResponse:
    type: object
    properties:
      username:
        type: string
      emails:
        type: array
        items:
          $ref: '#/definitions/UserEmail'
      uuid:
        type: string
  UserList:
    type: object
    properties:
      total:
        type: integer
        description: The number of users
      filtered:
        type: integer
        description: The number of users matching the searched term
      items:
        type: array
        items:
          $ref: '#/definitions/UserResult'
        description: A paginated list of users
  UserResult:
    type: object
    properties:
      uuid:
        type: string
      username:
        type: string
      main_email_address:
        type: string
  Error:
    type: object
    properties:
      reason:
        type: array
        items:
          type: string
      timestamp:
        type: array
        items:
          type: string
      status_code:
        type: integer
